S1 <- function (x, y, r) (54+105*x+41*x^2-10*x^3)*y/6*r*(1+x)*(27+27*x-4*x^2)
S2 <- function (x, y, r, a, h) (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))

SA <- function(x, y, r, a, h) {
S1 <- (54+105*x+41*x^2-10*x^3)*y/6*r*(1+x)*(27+27*x-4*x^2)
S2 <- (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))
S1+S2
}

SB <- function(x, y, r, a, h) {
S1 <- (54+105*x+41*x^2-10*x^3)*y/6*r*(1+x)*(27+27*x-4*x^2)
S2 <- (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))
S1-S2
}

P1 <- (9+15*x)*h/9*（1+x）
P2 <- (9+11*x)*a/(27+27*x-4*x^2)
P3 <- (9+11*x)*y*2*S2/(27+27*x-4*x^2)

PA1 <- function(x, y, r, a, h) {
S1 <- (54+105*x+41*x^2-10*x^3)*y/6*r*(1+x)*(27+27*x-4*x^2)
S2 <- (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))
P1 <- (9+15*x)*h/9*(1+x)
P2 <- (9+11*x)*a/(27+27*x-4*x^2)
P3 <- (9+11*x)*y*2*S2/(27+27*x-4*x^2)
P1+P2+P3
}

PB1 <- function(x, y, r, a, h) {
S1 <- (54+105*x+41*x^2-10*x^3)*y/6*r*(1+x)*(27+27*x-4*x^2)
S2 <- (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))
P1 <- (9+15*x)*h/9*(1+x)
P2 <- (9+11*x)*a/(27+27*x-4*x^2)
P3 <- (9+11*x)*y*2*S2/(27+27*x-4*x^2)
P1-P2-P3
}

PA2 <- function(x, y, r, a, h) {
S1 <- (54+105*x+41*x^2-10*x^3)*y/6*r*(1+x)*(27+27*x-4*x^2)
S2 <- (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))
P1 <- (9+15*x)*h/9*(1+x)
P2 <- (9+11*x)*a/(27+27*x-4*x^2)
P3 <- (9+11*x)*y*2*S2/(27+27*x-4*x^2)
PA1 <- P1+P2+P3
PB1 <- P1-P2-P3
(3*h+a+y*2*S2+x*(PA1-PB1))/3*(1+x)
}

PB2 <- function(x, y, r, a, h) {
S1 <- (54+105*x+41*x^2-10*x^3)*y/6*r*(1+x)*(27+27*x-4*x^2)
S2 <- (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))
P1 <- (9+15*x)*h/9*(1+x)
P2 <- (9+11*x)*a/(27+27*x-4*x^2)
P3 <- (9+11*x)*y*2*S2/(27+27*x-4*x^2)
PA1 <- P1+P2+P3
PB1 <- P1-P2-P3
(3*h-a-y*2*S2-x*(PA1-PB1))/3*(1+x)
}

PIA <- function(x, y, r, a, h) {
S1 <- (54+105*x+41*x^2-10*x^3)*y/(6*r*(1+x)*(27+27*x-4*x^2))
S2 <- (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))
P1 <- (9+15*x)*h/(9*(1+x))
P2 <- (9+11*x)*a/(27+27*x-4*x^2)
P3 <- (9+11*x)*y*2*S2/(27+27*x-4*x^2)
PA1 <- P1+P2+P3
PB1 <- P1-P2-P3
PA2 <- (3*h+a+y*2*S2+x*(PA1-PB1))/(3*(1+x))
PB2 <- (3*h-a-y*2*S2-x*(PA1-PB1))/(3*(1+x))
PA1*(PB1-PA1+y*2*S2+a+h)/(2*h)+PA2*((y*2*S2+a+h)/(2*h)+(1+x)*(PB2-PA2)/(2*h)-x*(PB1-PA1)/(2*h))-r*(S1+S2)^2
}

PIA <- function(x, y, r=1, a=4, h=5) {
S1 <- (54+105*x+41*x^2-10*x^3)*y/(6*r*(1+x)*(27+27*x-4*x^2))
S2 <- (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))
P1 <- (9+15*x)*h/(9*(1+x))
P2 <- (9+11*x)*a/(27+27*x-4*x^2)
P3 <- (9+11*x)*y*2*S2/(27+27*x-4*x^2)
PA1 <- P1+P2+P3
PB1 <- P1-P2-P3
PA2 <- (3*h+a+y*2*S2+x*(PA1-PB1))/(3*(1+x))
PB2 <- (3*h-a-y*2*S2-x*(PA1-PB1))/(3*(1+x))
PA1*(PB1-PA1+y*2*S2+a+h)/(2*h)+PA2*((y*2*S2+a+h)/(2*h)+(1+x)*(PB2-PA2)/(2*h)-x*(PB1-PA1)/(2*h))-r*(S1+S2)^2
}


y <- seq(0,1,0.05)
x <- seq(0,1,0.05)
PIA <- function(x, y, r=1, a=0, h=5) {
S1 <- (54+105*x+41*x^2-10*x^3)*y/(6*r*(1+x)*(27+27*x-4*x^2))
S2 <- (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))
P1 <- (9+15*x)*h/(9*(1+x))
P2 <- (9+11*x)*a/(27+27*x-4*x^2)
P3 <- (9+11*x)*y*2*S2/(27+27*x-4*x^2)
PA1 <- P1+P2+P3
PB1 <- P1-P2-P3
PA2 <- (3*h+a+y*2*S2+x*(PA1-PB1))/(3*(1+x))
PB2 <- (3*h-a-y*2*S2-x*(PA1-PB1))/(3*(1+x))
PA1*(PB1-PA1+y*2*S2+a+h)/(2*h)+PA2*((y*2*S2+a+h)/(2*h)+(1+x)*(PB2-PA2)/(2*h)-x*(PB1-PA1)/(2*h))-r*(S1+S2)^2
}

PIA2 <- function(x, y, r=1, a=4, h=5) {
S1 <- (54+105*x+41*x^2-10*x^3)*y/(6*r*(1+x)*(27+27*x-4*x^2))
S2 <- (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))
P1 <- (9+15*x)*h/(9*(1+x))
P2 <- (9+11*x)*a/(27+27*x-4*x^2)
P3 <- (9+11*x)*y*2*S2/(27+27*x-4*x^2)
PA1 <- P1+P2+P3
PB1 <- P1-P2-P3
PA2 <- (3*h+a+y*2*S2+x*(PA1-PB1))/(3*(1+x))
PB2 <- (3*h-a-y*2*S2-x*(PA1-PB1))/(3*(1+x))
PA1*(PB1-PA1+y*2*S2+a+h)/(2*h)+PA2*((y*2*S2+a+h)/(2*h)+(1+x)*(PB2-PA2)/(2*h)-x*(PB1-PA1)/(2*h))-r*(S1+S2)^2
}
z <- outer(x,y,PIA)
w <- outer(x,y,PIA2)

persp(x,y,z,theta=30,phi=10,expand=0.7,col="blue",add="TURE")
persp(x,y,w,theta=30,phi=10,expand=0.7,col="red")



x <- seq(0,1,0.05)
PIA <- function(x) {
y <- 0.6
r <- 1
a <- 0 
h <-5
S1 <- (54+105*x+41*x^2-10*x^3)*y/(6*r*(1+x)*(27+27*x-4*x^2))
S2 <- (162+495*x+496*x^2+155*x^3-8*x^4)*y*a/(2*h*r*(1+x)*(27+27*x-4*x^2)^2-2*y^2*(162+495*x+496*x^2+155*x^3-8*x^4))
P1 <- (9+15*x)*h/(9*(1+x))
P2 <- (9+11*x)*a/(27+27*x-4*x^2)
P3 <- (9+11*x)*y*2*S2/(27+27*x-4*x^2)
PA1 <- P1+P2+P3
PB1 <- P1-P2-P3
PA2 <- (3*h+a+y*2*S2+x*(PA1-PB1))/(3*(1+x))
PB2 <- (3*h-a-y*2*S2-x*(PA1-PB1))/(3*(1+x))
PA1*(PB1-PA1+y*2*S2+a+h)/(2*h)+PA2*((y*2*S2+a+h)/(2*h)+(1+x)*(PB2-PA2)/(2*h)-x*(PB1-PA1)/(2*h))-r*(S1+S2)^2
}
z<- PIA(x)
df<-data.frame(x,z)
g<-ggplot(df,aes(x,z))
g<-g+geom_line(col='red') #红色曲线
g<-g+geom_hline(yintercept=0)+geom_vline(yintercept=0) #坐标轴
g


require(ggplot2)
f1 <- function(x)  x^4+1*x^3+5*x^2+6*x+11
x<-seq(-5,5,by=0.01)
x
y<-f1(x)
df<-data.frame(x,y)
g<-ggplot(df,aes(x,y))
g<-g+geom_line(col='red') #红色直线
g<-g+geom_hline(yintercept=0)+geom_vline(yintercept=0) #坐标轴
g


l1=function(b){
w=(1+b^2)/(1+(b-1)^2)
2*log(w)
}
b=seq(from=-3,to=3,by=0.01)
y1=l1(b)

l2=function(b){
w=(1+b^2)/(1+(b-0.75)^2)
2*log(w)
}
y2=l2(b)

l3=function(b){
w=(1+b^2)/(1+(b-0.5)^2)
2*log(w)
}
y3=l3(b)

l4=function(b){
w=(1+b^2)/(1+(b-0.25)^2)
2*log(w)
}
y4=l4(b)


plot(b,y1,ylim=c(0,max(y1,y2,y3,y4)),col='red')
points(b,y2,col='green')
points(b,y3,col='blue')
points(b,y4,col='cyan')
